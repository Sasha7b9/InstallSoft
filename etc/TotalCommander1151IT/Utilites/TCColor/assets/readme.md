# TC Color Presets

Модификация утилиты `IMPOMEZIA TC Color Presets` версии 0.1.1.7 от Александра Серова. Указанная версия оригинала скачивается в составе сборки `IMPOMEZIA Total Commander` со [страницы проекта](https://impomezia.com/projects/itotalcmd) (дата обращения: 22.09.2022).  

Утилита занимается хранением наборов цветовых настроек программы `Total Commander` (далее: цветовые схемы TC), с возможностью их просмотра и применения к текущим настройкам TC.  

При первом запуске в папке утилиты автоматически создаётся файл `colors.ini`. Далее настройки утилиты производятся непосредственной правкой этого файла. Объяснения настроек см. в комментариях `colors.ini`.  

При первом запуске утилиты рекомендуется сохранить текущую цветовую схему TC в отдельный файл, для чего в меню утилиты имеется соответствующая команда. Это необходимо для того, чтобы можно было вернуться к исходной схеме после применения других схем. Кроме того, откат к исходному состоянию настроек можно совершить восстановлением файла `wincmd.ini` из резервной копии, которые создаются утилитой автоматически при каждом старте.  

В случае если в `Total Commander` установлены плагины `Autorun` и/или `TWinKey` и/или `TCFS2Tools`, и настроена их автозагрузка (о подробностях см. в справках к плагинам), то при первом старте утилиты необходимо вызвать соответствующие команды из меню `WDX плагины`. Команды вносят записи о плагинах в цветовые схемы (во все сразу, или в одну выбранную), благодаря чему при применении схем функциональность плагинов не нарушается. После удаления плагинов (если таковое произойдёт), необходимо удалить и записи о них из схем (опять же при помощи соответствующих команд меню).  

При каждом старте утилиты текущая цветовая схема TC автоматически копируется в файл `current.ini` и сохраняется в нём без изменений до перезапуска утилиты. Т.о. можно применять к окну TC (перезагружая TC) различные схемы, просматривая их, после чего применить `Текущую схему TC`, вернувшись тем самым к исходному состоянию настроек, как до старта утилиты.  

В комплекте утилиты присутствуют два исполняемых файла: `colors32.exe` и `colors64.exe` (32-битный и 64-битный). Нет необходимости использовать и хранить файлы обеих битностей (поскольку программа не использует функций, зависящих от битности). Если вы используете ваш TC на системах обеих битностей, то достаточно будет одного 32-битного файла; если только на системах 64-бит, то одного 64-битного.  

## О работе утилиты

Цветовые настройки `Total Commander` хранятся в файле `wincmd.ini`, в следующих секциях и ключах _(по состоянию в TC версии 11.01)_ :  

1. Секция **`[Colors]`** вся полностью.  
2. Секция **`[ColorsDark]`** вся полностью.  
3. Секция **`[ListerDark]`** вся полностью.  
4. Отдельные ключи в секции **`[Lister]`** :  
   1. `FgColor`  
   2. `BgColor`  
   3. `FgSelColor`  
   4. `BgSelColor`  
   5. `LinkColor`  
5. Отдельные ключи в секции **`[Configuration]`** :  
   1. `InactiveFocus`  
   2. `SelectionFocus`  
6. Отдельный ключ в секции **`[Layout]`** :  
   1. `DarkListBorders`  

Содержимое перечисленных секций/ключей составляет текущую цветовую схему TC.  

При помощи утилиты текущая цветовая схема может быть скопирована из `wincmd.ini` в отдельный файл `<preset>.ini`, где `<preset>` — имя, выбираемое пользователем. Сохранённые схемы переносимы, ими можно обмениваться. При помощи утилиты можно вновь применить одну из схем к `wincmd.ini`. При применении схемы её настройки копируются в `wincmd.ini` с заменой существующих (т.о. сохранённая схема становится текущей цветовой схемой TC). Замене подвергаются только секции и ключи, отвечающие за цвет, все остальные данные остаются нетронутыми.  

Помимо перечисленных сугубо цветовых настроек в схему могут также включаться поисковые шаблоны из секции **`[Searches]`**. Для непосредственной работы с цветом эти шаблоны не предназначены, но они могут использоваться для ракраски групп файлов в секции **`[Colors]`**. В связи с этим работа утилиты с содержимым секции **`[Searches]`** осуществляется следующим образом:  

1. Если поисковый шаблон упомянут в секции **`[Colors]`**, то он считается частью цветовой схемы, следовательно обрабатывается утилитой вместе с другими данными схемы: сохраняется в `<preset>.ini`, применяется к `wincmd.ini`, удаляется из `wincmd.ini` при применении другой схемы.  
2. Если поисковый шаблон не упомянут в секции **`[Colors]`**, то он не считается частью цветовой схемы, следовательно игнорируется утилитой и оставляется в `wincmd.ini` нетронутым.  

Наглядный пример обработки секции **`[Searches]`** :  

```
┌──────────────────────────────────────┬───────────────────────────────────┬──────────────────────────────────────┐
│ wincmd.ini до применения             │ применяется сохранённая схема     │ wincmd.ini после применения          │
├──────────────────────────────────────┼───────────────────────────────────┼──────────────────────────────────────┤
│ [Colors]                             │ [Colors]                          │ [Colors]                             │
│ ColorFilter1=прежний_поиск_шаблон_1  │ ColorFilter1=новый_поиск_шаблон_1 │ ColorFilter1=новый_поиск_шаблон_1    │
│ ColorFilter2=прежний_поиск_шаблон_2  │ ColorFilter2=новый_поиск_шаблон_2 │ ColorFilter2=новый_поиск_шаблон_2    │
├──────────────────────────────────────┼───────────────────────────────────┼──────────────────────────────────────┤
│ [Searches]                           │ [Searches]                        │ [Searches]                           │
│ прежний_поиск_шаблон_1=...           │ новый_поиск_шаблон_1=...          │ новый_поиск_шаблон_1=...             │
│ прежний_поиск_шаблон_2=...           │ новый_поиск_шаблон_2=...          │ новый_поиск_шаблон_2=...             │
│ прежний_поиск_шаблон_3_нецветной=... │                                   │ прежний_поиск_шаблон_3_нецветной=... │
│ прежний_поиск_шаблон_4_нецветной=... │                                   │ прежний_поиск_шаблон_4_нецветной=... │
└──────────────────────────────────────┴───────────────────────────────────┴──────────────────────────────────────┘
```

Если есть желание сохранить в схему поисковые шаблоны, не участвующие в цветовом оформлении, можно поступить следующим образом. Присвоить таким шаблонам нейтральный цвет, тогда визуально они не будут чем-либо отличаться, но утилита автоматически распознает их как часть цветовой схемы и включит в обработку. Нейтральным цветом в рамках схемы является `ForeColor` — цвет текста в панелях.  

Наглядный пример:  

```
[Colors]
ForeColor=чёрный
ColorFilter1=поиск_шаблон_1
ColorFilter1Color=зелёный
ColorFilter2=поиск_шаблон_2
ColorFilter2Color=красный
ColorFilter3=поиск_шаблон_3_нецветной
ColorFilter3Color=чёрный
ColorFilter4=поиск_шаблон_4_нецветной
ColorFilter4Color=чёрный

[Searches]
поиск_шаблон_1=...
поиск_шаблон_2=...
поиск_шаблон_3_нецветной=...
поиск_шаблон_4_нецветной=...
```

## Условия распространения

Права на модификацию не ограничены. Никаких гарантий и ответственности. Читайте, пожалуйста, внимательно readme, history, сохраняйте резервные копии wincmd.ini, и всё будет хорошо.  

## Благодарности

@ **Avada** за справочник по ключам `wincmd.ini`  
@ **Skif_off** за алгоритм перезапуска `Total Commander`  
@ **Loopback** за некоторые ф-ции `AutoIt`  
@ **AZJIO** за некоторые ф-ции `AutoIt`  

